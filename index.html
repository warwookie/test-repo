
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>SNEAKERQUEST</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/bold/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    :root {
      --primary-color: #ff3a2f;
      --secondary-color: #d6c7a4;
      --bg-dark: #0a0a0a;
      --bg-medium: #1a1510;
      --bg-light: #2a2119;
      --wood-light: #b99b66;
      --wood-medium: #876a46;
      --wood-dark: #56432e;
      --screen-bg: #0a241f;
      --led-glow: rgba(255, 58, 47, 0.45);
      --center-cell: 90px; /* shared target width for middle HUD cells (hearts & pause) */
    }

    html, body { display: flex; align-items: flex-start; justify-content: center; overflow: hidden; padding: 0 env(safe-area-inset-right,0) 0 env(safe-area-inset-left,0); background: var(--bg-dark); color: var(--secondary-color); font-family: system-ui, -apple-system, sans-serif; -webkit-user-select: none; user-select: none; min-height: 100dvh; }

    /* bottom-pinned layout (single body rule above) */

    .fixed-container { width: 430px; aspect-ratio: 430 / 900; position: absolute; top: 0; left: 50%; transform-origin: top center; height: auto; max-width: 100vw; margin: 0; }

    .cabinet { width: 100%; height: 100%; border-radius: 28px; padding: 14px; background:
      radial-gradient(120% 120% at 50% 0, #000 0%, #000 18%, transparent 18%),
      linear-gradient(var(--wood-light), #cbb17d 22%, #a98756 22%, #a98756 23%, var(--wood-medium) 23%, var(--wood-medium) 24%, var(--wood-dark) 24%, var(--wood-dark) 25%, #3d3123 25%, #3d3123 100%);
      box-shadow: inset 0 0 0 2px var(--bg-light), 0 24px 40px rgba(0,0,0,.5), 0 6px 0 var(--bg-dark);
    }

    .inner { width: 100%; height: 100%; border-radius: 22px; background: linear-gradient(#6c5640, #3c2f23 14%, #2e251d 14%, #2e251d); box-shadow: inset 0 0 0 2px var(--bg-light), inset 0 0 0 6px var(--bg-medium); position: relative; display: flex; flex-direction: column; align-items: center; padding: 20px; gap: 20px; overflow: hidden; }

    /* Marquee section */
    .marquee { width: 100%; height: 90px; border-radius: 18px; padding: 12px 14px; background: linear-gradient(#2a2320, #1d1815); box-shadow: inset 0 0 0 2px #120e0c, inset 0 0 0 6px #2f2722, 0 2px 0 #0a0807; display: flex; align-items: center; justify-content: center; }

    .led { width: 100%; height: 100%; border-radius: 12px; background: radial-gradient(circle at 8px 10px, rgba(255,255,255,.1), transparent 28%), repeating-linear-gradient(180deg, rgba(0,0,0,.4) 0 3px, transparent 3px 10px), #120e0c; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 6px 10px; position: relative; overflow: hidden; }

    .mq-wrap { display: grid; justify-items: center; align-content: center; height: 100%; }

    .mq-title { font-size: 27px; text-align: center; user-select: none; color: var(--primary-color); text-shadow: 0 0 2px var(--primary-color), 0 0 8px var(--led-glow); animation: led-flicker 3.6s ease-in-out infinite; font-family: 'Press Start 2P', system-ui, -apple-system, sans-serif; }

    .mq-sub { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; font-size: 7px; letter-spacing: .12em; margin-top: 6px; font-family: 'Press Start 2P', system-ui, -apple-system, sans-serif; }
    .mq-sub .chip { white-space: nowrap; }
    .mq-sub .chip-box { padding: 4px 3px; border: 2px solid var(--primary-color); border-radius: 4px; color: var(--primary-color); text-shadow: 0 0 2px var(--primary-color); animation: led-flicker 3.6s ease-in-out infinite; }

    @keyframes led-flicker { 0% { opacity: 0.96; text-shadow: 0 0 2px var(--primary-color), 0 0 6px rgba(255,58,47,.38), 0 0 12px rgba(255,58,47,.2); } 50% { opacity: 1; text-shadow: 0 0 2px var(--primary-color), 0 0 9px rgba(255,58,47,.5), 0 0 16px rgba(255,58,47,.28); } 100% { opacity: 0.97; text-shadow: 0 0 2px var(--primary-color), 0 0 6px rgba(255,58,47,.38), 0 0 12px rgba(255,58,47,.2); } }

    .divider { width: 100%; height: 12px; border-radius: 10px; background: linear-gradient(#3b3026, #2a231e); box-shadow: inset 0 0 0 2px var(--bg-medium); }

    .crt-wrap { width: 100%; height: auto; border-radius: 20px; padding: 10px; background: linear-gradient(#3c2f26, #241e18); box-shadow: inset 0 0 0 2px #1a140f, inset 0 0 0 8px #2a211a; display: flex; align-items: center; justify-content: center; position: relative; }

    .crt { width: 100%; border-radius: 11px; aspect-ratio: 0.94; background: linear-gradient(180deg, rgba(255,255,255,.1), transparent 22%), linear-gradient(var(--screen-bg), #0b2823); box-shadow: inset 0 0 0 2px #0e1412, inset 0 0 30px rgba(0,0,0,.6); display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }

    /* Game Canvas */
    #gameCanvas { width: 100%; height: 100%; display: block; border-radius: 11px; image-rendering: pixelated; }

    .tabs { width: 100%; height: 70px; border-radius: 14px; background: linear-gradient(#3a2f26, #2b231d); box-shadow: inset 0 0 0 2px #1a1410; display: grid; grid-template-columns: 1fr auto 1fr; gap: 10px; padding: 10px 8px; text-align: center; font-weight: 800; letter-spacing: 0.08em; margin-top: -14px; }

    .tab { display: flex; align-items: stretch; min-width: 0; }

    .tab .led { height: 100%; border-radius: 10px; padding: 8px 10px; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; width: 100%; }

    .tab .led .line { font-size: 10px; letter-spacing: .14em; color: var(--primary-color); font-weight: 800; text-shadow: 0 0 2px var(--primary-color); animation: led-flicker 3.6s ease-in-out infinite; font-family: 'Press Start 2P', system-ui, -apple-system, sans-serif; white-space: nowrap; min-width: 0; }

    .hud { width: 100%; display: grid; grid-template-columns: 1fr minmax(auto, var(--center-cell)) 1fr; gap: 3px; margin-top: -16px; }
    .hud .slot-heart{ height: 41px; }
    .hud .slot-shoes{ height: 40px; }
    .hud .slot-dots{ height: 40px; }

    .hud2 { width: 100%; display: grid; grid-template-columns: 1fr minmax(auto, var(--center-cell)) 1fr; gap: 3px; margin-top: -15px; }
    .hud2 .slot-flames{ height: 40px; }

    /* keep the center HUD cells from stretching; center them */
    .slot-shoes, .slot-pause { justify-self: center; max-width: var(--center-cell); width: 100%; }
    .hud2 .slot-bag{ height: 40px; }

    .slot { background: linear-gradient(#3a3227, #2c251e); border-radius: 14px; padding: 5px; box-shadow: inset 0 0 0 2px #1a1511, 0 2px 0 #0b0907; display: flex; align-items: center; justify-content: center; overflow: hidden; height: 100%; width: 100%; }
    .slot > .led { height: 100%; width: 100%; border-radius: 10px; padding: 8px 10px; display: flex; align-items: center; justify-content: center; }
    .slot > .led .line { display: flex; align-items: center; gap: 10px; letter-spacing: .12em; width: 100%; justify-content: center; }

    /* Icon Containers */
    #ui-sneakers, #ui-hearts, #ui-fires, #ui-powers { display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; padding: 0 4px; box-sizing: border-box; }

    /* Tighter middle-slot spacing */
    .slot-shoes > .led, .slot-pause > .led { padding: 4px 6px; }
    #ui-hearts { gap: 2px; }
    #ui-hearts .heart-outline, #ui-hearts .heart-fill { font-size: 20px; }

    /* Pause button should not force wide box */
    .slot-pause .chip-btn { min-width: auto; letter-spacing: .10em; font-size: 11px; }

    /* Icons */
    #ui-sneakers { gap: 3px; }
    .sneaker-icon { position: relative; display: inline-flex; align-items: center; justify-content: center; }
    .sneaker-outline { color: var(--primary-color); font-size: 20px; filter: drop-shadow(0 0 2px var(--primary-color)); }
    .sneaker-fill { position: absolute; top: 0; left: 0; color: var(--secondary-color); font-size: 20px; opacity: 0; transition: opacity 0.3s ease; }
    .sneaker-icon.active .sneaker-fill { opacity: 1; }

    #ui-hearts { gap: 4px; }
    .heart-icon { position: relative; display: inline-flex; align-items: center; justify-content: center; }
    .heart-outline { color: var(--primary-color); font-size: 20px; filter: drop-shadow(0 0 2px var(--primary-color)); }
    .heart-fill { position: absolute; top: 0; left: 0; color: var(--secondary-color); font-size: 20px; opacity: 0; transition: opacity 0.3s ease; }
    .heart-icon.active .heart-fill { opacity: 1; }

    #ui-fires { gap: 2px; }
    .fire-icon { position: relative; display: inline-flex; align-items: center; justify-content: center; }
    .fire-outline { color: var(--primary-color); font-size: 20px; filter: drop-shadow(0 0 2px var(--primary-color)); }
    .fire-fill { position: absolute; top: 0; left: 0; color: var(--secondary-color); font-size: 20px; opacity: 0; transition: opacity 0.3s ease; }
    .fire-icon.active .fire-fill { opacity: 1; }

    #ui-powers { gap: 7px; }
    .power { position: relative; display: inline-flex; align-items: center; justify-content: center; }
    .power .ph-bold { color: var(--primary-color); font-size: 20px; filter: drop-shadow(0 0 2px var(--primary-color)); }
    .power .ph-fill { position: absolute; top: 0; left: 0; color: var(--secondary-color); font-size: 20px; opacity: 0; transition: opacity 0.3s ease; }
    .power.active .ph-fill { opacity: 1; }

    .chip-btn { background: transparent; border: 0; border-radius: 0; padding: 0; display: grid; place-items: center; color: var(--primary-color); font: inherit; letter-spacing: .12em; cursor: pointer; min-height: 1em; line-height: 1; min-width: 6ch; font-size: 12px; font-family: 'Press Start 2P', system-ui, -apple-system, sans-serif; }
    .chip-btn:focus-visible { outline: none; text-shadow: 0 0 6px var(--primary-color), 0 0 12px rgba(255,58,47,.4); }
    .chip-btn .word { grid-area: 1/1; display: block; text-align: center; opacity: 0; transform: translateY(6%); transition: opacity .24s ease, transform .24s ease; }
    #btn-pause[data-state=playing] .word-pause { opacity: 1; transform: none; }
    #btn-pause[data-state=paused] .word-play { opacity: 1; transform: none; }

    .counter { display: flex; align-items: center; gap: 10px; color: var(--primary-color); text-shadow: 0 0 6px var(--primary-color), 0 0 18px rgba(255,58,47,.45); font-weight: 900; letter-spacing: .14em; }
    .seven { font-family: 'Press Start 2P', ui-monospace, Menlo, Consolas, monospace; font-size: 14px; color: var(--secondary-color); }
    .counter .ph-package { font-size: 20px !important; color: var(--secondary-color) !important; filter: none !important; }

    .bottom { width: 100%; height: 150px; margin-top: -13px; }

    .control-screen { position: relative; height: 100%; border-radius: 18px; padding: 14px; display: grid; grid-template-columns: 82% 20%; gap: 14px; align-items: center; overflow: hidden; background: linear-gradient(#1a1210, #0c0908); box-shadow: inset 0 0 0 2px #1a1510, inset 0 16px 30px rgba(0,0,0,.4), 0 3px 0 #0a0807; }

    .matrix { position: absolute; inset: 6px; border-radius: 14px; opacity: .9; mix-blend-mode: screen; pointer-events: none; background: radial-gradient(circle at center, #140202 40%, #090101 42%, transparent 43%) 0 0 / 10px 10px repeat; }

    @media (max-width: 400px) { 
      .mq-title{font-size:22px;} 
      .mq-sub{font-size:6px;} 
      .tab .led .line{font-size:9px; letter-spacing:.10em; white-space:nowrap;}
    }
    @media (max-width: 390px){
      :root{ --center-cell: 86px; }
      .hud, .hud2{ grid-template-columns: 1fr minmax(auto, var(--center-cell)) 1fr; gap: 2px; }
      #ui-sneakers{gap:2px;} #ui-hearts{gap:2px;} #ui-fires{gap:2px;} #ui-powers{gap:5px;}
      .sneaker-outline, .sneaker-fill,
      .heart-outline,   .heart-fill,
      .fire-outline,    .fire-fill,
      .power .ph-bold,  .power .ph-fill { font-size: 18px; }
      .slot-shoes > .led, .slot-pause > .led { padding: 4px 6px; }
      .tab .led .line{font-size:9px; letter-spacing:.10em;}
    }
    @media (max-width: 360px){
      :root{ --center-cell: 82px; }
      .hud, .hud2{ grid-template-columns: 1fr minmax(auto, var(--center-cell)) 1fr; }
      .tab .led .line{ font-size: 8.5px; letter-spacing: .08em; }
      .sneaker-outline, .sneaker-fill,
      .heart-outline,   .heart-fill,
      .fire-outline,    .fire-fill,
      .power .ph-bold,  .power .ph-fill { font-size: 17px; }
    }
    /* Disable zoom + selection */
  html, body { 
      overscroll-behavior: none;
      -webkit-user-select: none; user-select: none;
      touch-action: none; /* block pinch/pan */
      -ms-touch-action: none;
  }
</style>
</head>
<body>
  <div class="fixed-container" id="mainContainer">
    <div class="cabinet">
      <div class="inner">
        <div class="marquee" id="element-marquee">
          <div class="led">
            <div class="mq-wrap">
              <div class="line mq-title" id="titleSQ">SNEAKERQUEST</div>
              <div class="line mq-sub">
                <span class="chip chip-stage chip-box">STAGE&nbsp;‚Äì&nbsp;01</span>
                <span class="chip chip-time chip-box">00:00:0</span>
                <span class="chip chip-score chip-box">SCORE&nbsp;000000</span>
              </div>
            </div>
          </div>
        </div>

        <div class="divider" id="element-divider"></div>

        <div class="crt-wrap" id="element-crt">
          <div class="crt">
            <canvas id="gameCanvas"></canvas>
          </div>
        </div>

        <div class="tabs" id="element-tabs">
          <div class="tab"><div class="led"><div class="line">SNEAKERS</div></div></div>
          <div class="tab"><div class="led"><div class="line">LIFE</div></div></div>
          <div class="tab"><div class="led"><div class="line">POWER-UPS</div></div></div>
        </div>

        <div class="hud" id="element-hud1">
          <div class="slot slot-heart"><div class="led"><div class="line" aria-label="Sneakers" id="ui-sneakers"></div></div></div>
          <div class="slot slot-shoes"><div class="led"><div class="line" aria-label="Hearts" id="ui-hearts"></div></div></div>
          <div class="slot slot-dots"><div class="led"><div class="line" aria-label="Powers" id="ui-powers"></div></div></div>
        </div>

        <div class="hud2" id="element-hud2">
          <div class="slot slot-flames"><div class="led"><div class="line" aria-label="Fire" id="ui-fires"></div></div></div>
          <div class="slot slot-pause"><div class="led"><div class="line" aria-label="Pause / Play">
            <button class="chip-btn" id="btn-pause" type="button" aria-pressed="false" aria-label="Pause" data-state="playing">
              <span class="word word-pause" aria-hidden="false">PAUSE</span>
              <span class="word word-play" aria-hidden="true">PLAY</span>
            </button>
          </div></div></div>
          <div class="slot slot-bag"><div class="led"><div class="line counter" aria-label="Box count">
            <i class="ph-fill ph-package" aria-hidden="true"></i>
            <span style="opacity:.8;letter-spacing:.12em">x</span>
            <span class="seven" id="counter">000</span>
          </div></div></div>
        </div>

        <div class="bottom" id="element-bottom">
          <div class="control-screen" id="element-controls">
            <div class="matrix" aria-hidden="true"></div>
            <main class="control-ui" aria-label="Control surface">
              <section class="col-left"><div class="pad"></div></section>
              <section class="col-right"><div class="pad"></div></section>
            </main>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // === MOBILE SAFARI LAYOUT/SCALING ===
    class MobileSafariLock {
      static initialize() {
        MobileSafariLock.initializeAggressiveScaling();
      }

      static initializeAggressiveScaling() {
        const container = document.querySelector('.fixed-container');
        if (!container) return;

        const applyMeasuredFit = () => {
          const vv = window.visualViewport;
          const vh = vv ? vv.height : window.innerHeight; // visible height (excludes Safari bars)

          // Measure natural height with no transform
          const prev = container.style.transform;
          container.style.transform = 'none';
          const natH = Math.ceil(container.offsetHeight);
          container.style.transform = prev;

          const scale = Math.max(0.01, vh / Math.max(1, natH));
          container.style.transform = `translateX(-50%) scale(${scale})`;
        };

        const schedule = () => requestAnimationFrame(applyMeasuredFit);
        schedule();
        let t;
        window.addEventListener('resize', () => { clearTimeout(t); t = setTimeout(schedule, 80); });
        window.addEventListener('orientationchange', () => setTimeout(schedule, 250));
        window.addEventListener('pageshow', (e) => { if (e.persisted) schedule(); });
        if (window.visualViewport) {
          visualViewport.addEventListener('resize', schedule);
          visualViewport.addEventListener('scroll', schedule);
        }
      }
    }

    // === ICON MANAGER ===
    class IconManager {
      static updateAllIcons() {
        IconManager.renderSneakers(3, 5);
        IconManager.renderHearts(1, 3);
        IconManager.renderPowers(4, 4);
        IconManager.renderFires(4, 5);
      }
      static renderSneakers(fill, outline) {
        const c = document.getElementById('ui-sneakers'); if (!c) return; c.innerHTML = '';
        for (let i = 0; i < outline; i++) c.innerHTML += `
          <div class="sneaker-icon ${i < fill ? 'active' : ''}">
            <i class="ph-bold ph-sneaker sneaker-outline" aria-hidden="true"></i>
            <i class="ph-fill ph-sneaker sneaker-fill" aria-hidden="true"></i>
          </div>`;
      }
      static renderHearts(fill, outline) {
        const c = document.getElementById('ui-hearts'); if (!c) return; c.innerHTML = '';
        for (let i = 0; i < outline; i++) c.innerHTML += `
          <div class="heart-icon ${i < fill ? 'active' : ''}">
            <i class="ph-bold ph-heart heart-outline" aria-hidden="true"></i>
            <i class="ph-fill ph-heart heart-fill" aria-hidden="true"></i>
          </div>`;
      }
      static renderFires(fill, outline) {
        const c = document.getElementById('ui-fires'); if (!c) return; c.innerHTML = '';
        for (let i = 0; i < outline; i++) c.innerHTML += `
          <div class="fire-icon ${i < fill ? 'active' : ''}">
            <i class="ph-bold ph-fire fire-outline" aria-hidden="true"></i>
            <i class="ph-fill ph-fire fire-fill" aria-hidden="true"></i>
          </div>`;
      }
      static renderPowers(total, fill) {
        const c = document.getElementById('ui-powers'); if (!c) return; c.innerHTML = '';
        const types = [ { b:'ph-timer', f:'ph-timer' }, { b:'ph-shield', f:'ph-shield' }, { b:'ph-magnet', f:'ph-magnet' }, { b:'ph-crosshair-simple', f:'ph-crosshair-simple' } ];
        for (let i = 0; i < total; i++) {
          const t = types[i % types.length];
          c.innerHTML += `
            <div class="power ${i < fill ? 'active' : ''}">
              <i class="ph-bold ${t.b}" aria-hidden="true"></i>
              <i class="ph-fill ${t.f}" aria-hidden="true"></i>
            </div>`;
        }
      }
    }

    // === GAME SETUP ===
    function setupSimpleGame() {
      const canvas = document.getElementById('gameCanvas');
      const ctx = canvas.getContext('2d');

      function resizeCanvas() {
        const crt = document.querySelector('.crt');
        const cssW = crt.clientWidth;  const cssH = crt.clientHeight;

        canvas.style.width = cssW + 'px';
        canvas.style.height = cssH + 'px';

        const dpr = window.devicePixelRatio || 1;
        canvas.width  = Math.round(cssW * dpr);
        canvas.height = Math.round(cssH * dpr);

        ctx.setTransform(1, 0, 0, 1, 0, 0);
        ctx.scale(dpr, dpr);
        draw();

        // Self-tests
        console.assert(Math.abs(canvas.width  / (window.devicePixelRatio||1) - cssW) < 1, 'Canvas width backing store mismatch');
        console.assert(Math.abs(canvas.height / (window.devicePixelRatio||1) - cssH) < 1, 'Canvas height backing store mismatch');
      }

      function draw() {
        const w = canvas.clientWidth; const h = canvas.clientHeight;
        ctx.fillStyle = '#0a241f'; ctx.fillRect(0, 0, w, h);
        ctx.fillStyle = '#d6c7a4'; ctx.font = '20px "Press Start 2P"'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
        ctx.fillText('SNEAKER BOMBER', w / 2, h / 2 - 20);
        ctx.fillText('SPACE TO START', w / 2, h / 2 + 20);
      }

      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);
    }

    document.addEventListener('DOMContentLoaded', () => {
      MobileSafariLock.initialize();
      IconManager.updateAllIcons();
      setupSimpleGame();
      const pauseBtn = document.getElementById('btn-pause');
      if (pauseBtn) pauseBtn.addEventListener('click', function(){ this.dataset.state = this.dataset.state === 'playing' ? 'paused' : 'playing'; });
      setTimeout(() => { window.scrollTo(0, 0); }, 120);
    });

    // Simple UI API
    window.SneakerQuestUI = {
      IconManager,
      setSneakers: (f, t) => IconManager.renderSneakers(f, t),
      setHearts:   (f, t) => IconManager.renderHearts(f, t),
      setPowers:   (f, t) => IconManager.renderPowers(t, f),
      setFires:    (f, t) => IconManager.renderFires(f, t),
      setCounter:  (v) => { const el = document.getElementById('counter'); if (el) el.textContent = String(v).padStart(3, '0'); },
      setStage:    (s) => { const el = document.querySelector('.chip-stage'); if (el) el.textContent = `STAGE ‚Äì ${String(s).padStart(2, '0')}`; },
      setScore:    (v) => { const el = document.querySelector('.chip-score'); if (el) el.textContent = `SCORE ${String(v).padStart(6, '0')}`; },
      setTime:     (t) => { const el = document.querySelector('.chip-time');  if (el) el.textContent = t; }
    };
      // === HARD LOCK: disable zooming (pinch, double-tap, ctrl+wheel) ===
    (function lockPageZoom(){
        const opts = { passive: false };
        ['gesturestart','gesturechange','gestureend'].forEach(type=>
            document.addEventListener(type, e=>e.preventDefault(), opts)
        );
        // Block double‚Äëtap zoom
        let lastTouchEnd = 0;
        document.addEventListener('touchend', e=>{
            const now = Date.now();
            if (now - lastTouchEnd <= 350) e.preventDefault();
            lastTouchEnd = now;
        }, opts);
        // Block ctrl+wheel zoom (desktop)
        document.addEventListener('wheel', e=>{ if (e.ctrlKey) e.preventDefault(); }, opts);
        // iOS focus zoom workaround not needed (no inputs <16px)
    })();
</script>

  <!-- Step 1 bindings: state + LIFE + Stopwatch -->
  <script>
  (function(){
    // Ensure base state
    var defaultState = { mode:'single', active:false, specialActive:false, timerPowerup:false, laserAmmo:4, maxAmmo:4 };
    window.state = Object.assign({}, defaultState, window.state || {});

    function makeButtonish(el){
      if(!el) return;
      el.setAttribute('role', 'button');
      el.setAttribute('tabindex', '0');
      el.style.cursor = 'pointer';
    }

    function setupLife(){
      var lifeTab = document.querySelector('.tabs .tab:nth-child(2)');
      if (!lifeTab) return;
      makeButtonish(lifeTab);

      function toggleLife(){
        window.state.specialActive = !window.state.specialActive;
        if (window.state.specialActive) {
          window.state.laserAmmo = window.state.maxAmmo;
        }
        // Visual hook if styles exist
        lifeTab.classList.toggle('active', !!window.state.specialActive);
      }

      lifeTab.addEventListener('click', toggleLife);
      lifeTab.addEventListener('keydown', function(e){
        if (e.key === 'Enter' || e.key === ' ' || e.code === 'Space') {
          e.preventDefault();
          toggleLife();
        }
      });
    }

    function setupStopwatch(){
      var container = document.getElementById('ui-powers');
      if (!container) return;
      // find the power wrapper that contains a timer icon
      var nodes = Array.prototype.slice.call(container.querySelectorAll('.power'));
      var timerPower = nodes.find(function(n){ return n.querySelector('.ph-timer'); });
      if (!timerPower) return;

      makeButtonish(timerPower);

      function toggleTimer(){
        window.state.timerPowerup = !window.state.timerPowerup;
        timerPower.classList.toggle('active', !!window.state.timerPowerup);
      }

      // initial reflect
      timerPower.classList.toggle('active', !!window.state.timerPowerup);

      timerPower.addEventListener('click', toggleTimer);
      timerPower.addEventListener('keydown', function(e){
        if (e.key === 'Enter' || e.key === ' ' || e.code === 'Space') {
          e.preventDefault();
          toggleTimer();
        }
      });
    }

    function init(){
      setupLife();

      // powers are rendered dynamically; wait until present
      var tries = 0;
      (function waitForPowers(){
        var container = document.getElementById('ui-powers');
        if (container && container.children && container.children.length) {
          setupStopwatch();
        } else if (tries < 100) {
          tries++;
          setTimeout(waitForPowers, 50);
        }
      })();
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  })();
  </script>


  <!-- Layout Tuner: trigger + panel -->
  <style>
  /* --- SNEAKERQUEST Tuner Styles (scoped) --- */
  :root { 
    --settings-accent:#e6d7b6; 
    --settings-bg:#211a15; 
    --settings-surface:#332820; 
    --settings-border:#3a2f27; 
    --settings-text:#f0e6cd; 
  }
  #settingsBtn { 
    position: fixed; 
    right: 20px; 
    bottom: 20px; 
    width: 50px; 
    height: 50px; 
    border-radius: 12px; 
    border: none; 
    cursor: pointer; 
    background: #1a1410; 
    color: var(--settings-accent); 
    box-shadow: inset 0 0 0 2px #2a2119, 0 6px 12px #000; 
    font-size: 22px; 
    z-index: 7000; 
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #settingsPanel { 
    position: fixed; 
    right: 20px; 
    bottom: 80px; 
    width: min(450px, 90vw); 
    max-height: min(80vh, 700px); 
    background: var(--settings-bg); 
    color: var(--settings-text); 
    border: 2px solid var(--settings-border); 
    border-radius: 12px; 
    display: none; 
    flex-direction: column; 
    z-index: 7050; 
    box-shadow: 0 16px 40px #000c;
  }
  #settingsPanel.open { display: flex !important; }
  #sHead { 
    display: flex; 
    align-items: center; 
    justify-content: space-between; 
    padding: 12px 16px; 
    border-bottom: 1px solid var(--settings-border);
    background: var(--settings-surface);
  }
  #sTitle { 
    font-weight: 700; 
    letter-spacing: .08em; 
    font-size: 14px;
    color: var(--settings-accent);
  }
  #sBtns { display: flex; gap: 8px; }
  #sBtns button { 
    border: none; border-radius: 6px; padding: 6px 10px; 
    background: var(--settings-border); color: var(--settings-accent); 
    cursor: pointer; font-size: 12px; min-width: 30px;
  }
  #sBody { overflow: auto; padding: 16px; flex: 1; }
  .sg { 
    margin-bottom: 16px; border: 1px solid var(--settings-border); 
    border-radius: 8px; padding: 12px; background: var(--settings-surface);
  }
  .sg h4 { 
    margin: 0 0 12px 0; font-size: 13px; letter-spacing: .06em; 
    color: var(--settings-accent); border-bottom: 1px solid var(--settings-border);
    padding-bottom: 6px;
  }
  .sr { 
    display: grid; grid-template-columns: 1fr 100px 50px 30px; 
    gap: 8px; align-items: center; margin: 8px 0; font-size: 11px;
  }
  .sr label { 
    font-size: 11px; color: var(--settings-text); white-space: nowrap;
    overflow: hidden; text-overflow: ellipsis;
  }
  .sr input[type=range], .sr input[type=number], .sr input[type=text] { 
    width: 100%; background: var(--settings-bg); border: 1px solid var(--settings-border);
    border-radius: 4px; padding: 4px 6px; color: var(--settings-text); font-size: 11px;
  }
  .sr input[type=range] { padding: 0; }
  .sv { 
    font: 10px/1 monospace; text-align: center; color: var(--settings-accent);
    background: var(--settings-bg); padding: 4px; border-radius: 4px; border: 1px solid var(--settings-border);
    min-width: 40px;
  }
  .lock-btn { background: none; border: none; cursor: pointer; color: #888; font-size: 12px; padding: 4px; border-radius: 4px; }
  .lock-btn:hover { color: var(--settings-accent); }
  .lock-btn.locked { color: #ff3a2f; }
  #sFoot { 
    display: flex; gap: 8px; justify-content: space-between; align-items: center; 
    padding: 12px 16px; border-top: 1px solid var(--settings-border); background: var(--settings-surface);
  }
  #sFoot button { 
    flex: 1; border: none; background: var(--settings-border); color: var(--settings-accent); 
    border-radius: 6px; padding: 8px; cursor: pointer; min-width: 70px; font-size: 11px; font-weight: 600;
  }
  #copyMsg { font-size: 10px; opacity: 0; transition: opacity .3s ease; margin-left: 10px; white-space: nowrap; color: #ff3a2f; }
</style>
  <button id="settingsBtn" aria-label="Open settings" title="Settings">‚öôÔ∏è</button>
  <div id="settingsPanel" role="dialog" aria-modal="false" aria-label="Settings" tabindex="-1">
    <div id="sHead">
      <div id="sTitle">LAYOUT TUNER</div>
      <div id="sBtns">
        <button id="sMin" type="button" title="Minimize">‚Äì</button>
        <button id="sClose" type="button" title="Close">‚úï</button>
      </div>
    </div>
    <div id="sBody" aria-live="polite">
    <div id="sBody" aria-live="polite">
      <!-- Global Scale and Center -->
      <div class="sg">
        <h4>Global</h4>
        <div class="sr">
          <label for="v_scale">Cabinet Scale</label>
          <input id="v_scale" type="range" min="0.5" max="1.5" step="0.01" value="1">
          <div class="sv" id="o_scale">1.00</div>
          <button class="lock-btn" title="Lock">üîí</button>
        </div>
        <div class="sr">
          <label for="v_center_cell">Center Cell Width (px)</label>
          <input id="v_center_cell" type="range" min="60" max="160" step="1" value="90">
          <div class="sv" id="o_center_cell">90</div>
          <button class="lock-btn" title="Lock">üîí</button>
        </div>
      </div>

      <!-- Layout Spacing -->
      <div class="sg">
        <h4>Layout Spacing</h4>
        <div class="sr"><label for="v_gap_top">Marquee Top Margin</label>
          <input id="v_gap_top" type="range" min="-40" max="60" step="1" value="0">
          <div class="sv" id="o_gap_top">0</div><button class="lock-btn">üîí</button></div>

        <div class="sr"><label for="v_gap_div">Divider Top Margin</label>
          <input id="v_gap_div" type="range" min="-40" max="60" step="1" value="0">
          <div class="sv" id="o_gap_div">0</div><button class="lock-btn">üîí</button></div>

        <div class="sr"><label for="v_gap_crt">CRT Wrap Top Margin</label>
          <input id="v_gap_crt" type="range" min="-40" max="60" step="1" value="0">
          <div class="sv" id="o_gap_crt">0</div><button class="lock-btn">üîí</button></div>

        <div class="sr"><label for="v_gap_tabs">Tabs Top Margin</label>
          <input id="v_gap_tabs" type="range" min="-40" max="40" step="1" value="-14">
          <div class="sv" id="o_gap_tabs">-14</div><button class="lock-btn">üîí</button></div>

        <div class="sr"><label for="v_gap_hud1">HUD Row 1 Top Margin</label>
          <input id="v_gap_hud1" type="range" min="-40" max="60" step="1" value="-16">
          <div class="sv" id="o_gap_hud1">-16</div><button class="lock-btn">üîí</button></div>

        <div class="sr"><label for="v_gap_hud2">HUD Row 2 Top Margin</label>
          <input id="v_gap_hud2" type="range" min="-40" max="60" step="1" value="-15">
          <div class="sv" id="o_gap_hud2">-15</div><button class="lock-btn">üîí</button></div>

        <div class="sr"><label for="v_gap_bottom">Bottom Height</label>
          <input id="v_gap_bottom" type="range" min="80" max="240" step="1" value="150">
          <div class="sv" id="o_gap_bottom">150</div><button class="lock-btn">üîí</button></div>

        <div class="sr"><label for="v_bot_a">Control Screen Top Padding</label>
          <input id="v_bot_a" type="range" min="0" max="40" step="1" value="14">
          <div class="sv" id="o_bot_a">14</div><button class="lock-btn">üîí</button></div>

        <div class="sr"><label for="v_bot_b">Control Screen Bottom Padding</label>
          <input id="v_bot_b" type="range" min="0" max="40" step="1" value="14">
          <div class="sv" id="o_bot_b">14</div><button class="lock-btn">üîí</button></div>

        <div class="sr"><label for="v_global_pad_l">Inner Padding Left</label>
          <input id="v_global_pad_l" type="range" min="10" max="40" step="1" value="20">
          <div class="sv" id="o_global_pad_l">20</div><button class="lock-btn">üîí</button></div>

        <div class="sr"><label for="v_global_pad_r">Inner Padding Right</label>
          <input id="v_global_pad_r" type="range" min="10" max="40" step="1" value="20">
          <div class="sv" id="o_global_pad_r">20</div><button class="lock-btn">üîí</button></div>
      </div>

      <!-- Marquee -->
      <div class="sg">
        <h4>Marquee</h4>
        <div class="sr"><label for="v_mqtsize">Title Font Size</label>
          <input id="v_mqtsize" type="range" min="18" max="40" step="1" value="27">
          <div class="sv" id="o_mqtsize">27</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="v_mqtx">Title Translate X</label>
          <input id="v_mqtx" type="range" min="-40" max="40" step="1" value="0">
          <div class="sv" id="o_mqtx">0</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="v_mqty">Title Translate Y</label>
          <input id="v_mqty" type="range" min="-40" max="40" step="1" value="0">
          <div class="sv" id="o_mqty">0</div><button class="lock-btn">üîí</button></div>

        <div class="sr"><label for="v_mqssize">Subtitle Font Size</label>
          <input id="v_mqssize" type="range" min="5" max="12" step="1" value="7">
          <div class="sv" id="o_mqssize">7</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="v_mqsx">Subtitle Translate X</label>
          <input id="v_mqsx" type="range" min="-40" max="40" step="1" value="0">
          <div class="sv" id="o_mqsx">0</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="v_mqsy">Subtitle Translate Y</label>
          <input id="v_mqsy" type="range" min="-40" max="40" step="1" value="0">
          <div class="sv" id="o_mqsy">0</div><button class="lock-btn">üîí</button></div>

        <div class="sr"><label for="v_chipbr">Chip Border Radius</label>
          <input id="v_chipbr" type="range" min="0" max="10" step="1" value="4">
          <div class="sv" id="o_chipbr">4</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="v_chippadx">Chip Padding X</label>
          <input id="v_chippadx" type="range" min="0" max="10" step="1" value="3">
          <div class="sv" id="o_chippadx">3</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="v_chippady">Chip Padding Y</label>
          <input id="v_chippady" type="range" min="0" max="10" step="1" value="4">
          <div class="sv" id="o_chippady">4</div><button class="lock-btn">üîí</button></div>
      </div>

      <!-- HUD Icon Gaps -->
      <div class="sg">
        <h4>HUD Icon Gaps</h4>
        <div class="sr"><label for="v_icon_gap_sneakers">Sneakers Gap</label>
          <input id="v_icon_gap_sneakers" type="range" min="0" max="20" step="1" value="3">
          <div class="sv" id="o_icon_gap_sneakers">3</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="v_icon_gap_powers">Powers Gap</label>
          <input id="v_icon_gap_powers" type="range" min="0" max="20" step="1" value="7">
          <div class="sv" id="o_icon_gap_powers">7</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="v_icon_gap_fires">Fires Gap</label>
          <input id="v_icon_gap_fires" type="range" min="0" max="20" step="1" value="2">
          <div class="sv" id="o_icon_gap_fires">2</div><button class="lock-btn">üîí</button></div>
      </div>

      <!-- HUD Icon Counts -->
      <div class="sg">
        <h4>HUD Icon Counts</h4>
        <div class="sr"><label for="in_hearts_fill">Hearts Fill</label>
          <input id="in_hearts_fill" type="number" min="0" max="6" step="1" value="1">
          <div class="sv" id="o_hearts_fill">1</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="in_hearts_outline">Hearts Outline</label>
          <input id="in_hearts_outline" type="number" min="0" max="6" step="1" value="3">
          <div class="sv" id="o_hearts_outline">3</div><button class="lock-btn">üîí</button></div>

        <div class="sr"><label for="in_shoes_fill">Sneakers Fill</label>
          <input id="in_shoes_fill" type="number" min="0" max="6" step="1" value="3">
          <div class="sv" id="o_shoes_fill">3</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="in_shoes_outline">Sneakers Outline</label>
          <input id="in_shoes_outline" type="number" min="0" max="6" step="1" value="5">
          <div class="sv" id="o_shoes_outline">5</div><button class="lock-btn">üîí</button></div>

        <div class="sr"><label for="in_powers_fill">Powers Fill</label>
          <input id="in_powers_fill" type="number" min="0" max="8" step="1" value="4">
          <div class="sv" id="o_powers_fill">4</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="in_powers_total">Powers Total</label>
          <input id="in_powers_total" type="number" min="0" max="8" step="1" value="4">
          <div class="sv" id="o_powers_total">4</div><button class="lock-btn">üîí</button></div>

        <div class="sr"><label for="in_fires_fill">Fires Fill</label>
          <input id="in_fires_fill" type="number" min="0" max="8" step="1" value="4">
          <div class="sv" id="o_fires_fill">4</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="in_fires_outline">Fires Outline</label>
          <input id="in_fires_outline" type="number" min="0" max="8" step="1" value="5">
          <div class="sv" id="o_fires_outline">5</div><button class="lock-btn">üîí</button></div>
      </div>

      <!-- HUD Slot Heights -->
      <div class="sg">
        <h4>HUD Slot Heights</h4>
        <div class="sr"><label for="v_slotsneakers">Slot Sneakers Height</label>
          <input id="v_slotsneakers" type="range" min="30" max="60" step="1" value="41">
          <div class="sv" id="o_slotsneakers">41</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="v_slotshoes">Slot Shoes Height</label>
          <input id="v_slotshoes" type="range" min="30" max="60" step="1" value="40">
          <div class="sv" id="o_slotshoes">40</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="v_slotdots">Slot Dots Height</label>
          <input id="v_slotdots" type="range" min="30" max="60" step="1" value="40">
          <div class="sv" id="o_slotdots">40</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="v_slotflames">Slot Flames Height</label>
          <input id="v_slotflames" type="range" min="30" max="60" step="1" value="40">
          <div class="sv" id="o_slotflames">40</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="v_slotpause">Slot Pause Height</label>
          <input id="v_slotpause" type="range" min="30" max="60" step="1" value="40">
          <div class="sv" id="o_slotpause">40</div><button class="lock-btn">üîí</button></div>
        <div class="sr"><label for="v_slotbag">Slot Bag Height</label>
          <input id="v_slotbag" type="range" min="30" max="60" step="1" value="40">
          <div class="sv" id="o_slotbag">40</div><button class="lock-btn">üîí</button></div>
      </div>
    </div>
</div>
    <div id="sFoot">
      <button id="sReset" type="button">Reset</button>
      <span id="copyMsg"></span>
    </div>
  </div>

  <script>
  (function(){
    var btn = document.getElementById('settingsBtn');
    var panel = document.getElementById('settingsPanel');
    var closeBtn = document.getElementById('sClose');
    var minBtn = document.getElementById('sMin');
    var resetBtn = document.getElementById('sReset');

    function openPanel(){ panel.classList.add('open'); }
    function closePanel(){ panel.classList.remove('open'); }
    function minimizePanel(){ panel.classList.toggle('open'); }

    if (btn) btn.addEventListener('click', openPanel);
    if (closeBtn) closeBtn.addEventListener('click', closePanel);
    if (minBtn) minBtn.addEventListener('click', minimizePanel);

    function setText(id, v){ var el = document.getElementById(id); if(el) el.textContent = v; }

    // Target nodes
    var root = document.documentElement;
    var fixed = document.querySelector('.fixed-container');
    var sneakers = document.getElementById('ui-sneakers');
    var powers = document.getElementById('ui-powers');
    var fires = document.getElementById('ui-fires');
    var bottom = document.querySelector('.bottom');

    // v_scale -> transform translateX(-50%) scale(VALUE)
    var in_scale = document.getElementById('v_scale');
    function applyScale(){
      if(!fixed || !in_scale) return;
      var s = parseFloat(in_scale.value || '1') || 1;
      // preserve translateX(-50%)
      fixed.style.transform = 'translateX(-50%) scale(' + s.toFixed(2) + ')';
      setText('o_scale', s.toFixed(2));
    }
    if (in_scale) in_scale.addEventListener('input', applyScale);

    // v_center_cell -> :root --center-cell
    var in_center = document.getElementById('v_center_cell');
    function applyCenter(){
      if(!in_center) return;
      var n = Math.max(0, parseInt(in_center.value, 10) || 0);
      root.style.setProperty('--center-cell', n + 'px');
      setText('o_center_cell', String(n));
    }
    if (in_center) in_center.addEventListener('input', applyCenter);

    // v_icon_gap_sneakers -> #ui-sneakers gap
    var in_gap_sn = document.getElementById('v_icon_gap_sneakers');
    function applySneakerGap(){
      if(!sneakers || !in_gap_sn) return;
      var n = Math.max(0, parseInt(in_gap_sn.value, 10) || 0);
      sneakers.style.gap = n + 'px';
      setText('o_icon_gap_sneakers', String(n));
    }
    if (in_gap_sn) in_gap_sn.addEventListener('input', applySneakerGap);

    // v_icon_gap_powers -> #ui-powers gap
    var in_gap_pw = document.getElementById('v_icon_gap_powers');
    function applyPowerGap(){
      if(!powers || !in_gap_pw) return;
      var n = Math.max(0, parseInt(in_gap_pw.value, 10) || 0);
      powers.style.gap = n + 'px';
      setText('o_icon_gap_powers', String(n));
    }
    if (in_gap_pw) in_gap_pw.addEventListener('input', applyPowerGap);

    // v_icon_gap_fires -> #ui-fires gap
    var in_gap_fr = document.getElementById('v_icon_gap_fires');
    function applyFireGap(){
      if(!fires || !in_gap_fr) return;
      var n = Math.max(0, parseInt(in_gap_fr.value, 10) || 0);
      fires.style.gap = n + 'px';
      setText('o_icon_gap_fires', String(n));
    }
    if (in_gap_fr) in_gap_fr.addEventListener('input', applyFireGap);

    // v_gap_bottom -> .bottom height in px
    var in_gap_bottom = document.getElementById('v_gap_bottom');
    function applyBottomHeight(){
      if(!bottom || !in_gap_bottom) return;
      var n = Math.max(0, parseInt(in_gap_bottom.value, 10) || 0);
      bottom.style.height = n + 'px';
      setText('o_gap_bottom', String(n));
    }
    if (in_gap_bottom) in_gap_bottom.addEventListener('input', applyBottomHeight);

    // Initial apply once DOM is ready and IconManager has populated
    function initApply(){
      applyScale();
      applyCenter();
      applySneakerGap();
      applyPowerGap();
      applyFireGap();
      applyBottomHeight();
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initApply);
    } else {
      initApply();
    }
  })();
  </script>


<script>
(function(){
  function $(id){ return document.getElementById(id); }
  function setText(id, v){ var el=$(id); if(el) el.textContent=String(v); }

  // Targets
  var root = document.documentElement;
  var fixed = document.querySelector('.fixed-container');
  var marquee = document.querySelector('.marquee');
  var divider = document.querySelector('.divider');
  var crtWrap = document.querySelector('.crt-wrap');
  var tabs = document.querySelector('.tabs');
  var hud1 = document.getElementById('element-hud1');
  var hud2 = document.getElementById('element-hud2');
  var bottom = document.querySelector('.bottom');
  var controlScreen = document.querySelector('.control-screen');
  var inner = document.querySelector('.inner');
  var mqTitle = document.querySelector('.mq-title');
  var mqSub = document.querySelector('.mq-sub');
  var chipBoxes = document.querySelectorAll('.chip-box');
  var sneakers = document.getElementById('ui-sneakers');
  var powers = document.getElementById('ui-powers');
  var fires = document.getElementById('ui-fires');

  // Helpers
  function px(n){ return (parseInt(n,10)||0) + 'px'; }

  // Rebind stopwatch power accessibility + toggle after re-render
  function rebindStopwatch(){
    var container = document.getElementById('ui-powers');
    if (!container) return;
    var timerPower = Array.prototype.find.call(container.querySelectorAll('.power'), function(n){
      return n.querySelector('.ph-timer');
    });
    if (!timerPower) return;
    // aria + keyboard
    timerPower.setAttribute('role','button');
    timerPower.setAttribute('tabindex','0');
    timerPower.style.cursor = 'pointer';

    function onToggle(){
      window.state = window.state || { mode:'single', active:false, specialActive:false, timerPowerup:false, laserAmmo:4, maxAmmo:4 };
      window.state.timerPowerup = !window.state.timerPowerup;
      timerPower.classList.toggle('active', !!window.state.timerPowerup);
    }

    if (!timerPower.dataset.bound) {
      timerPower.addEventListener('click', onToggle);
      timerPower.addEventListener('keydown', function(e){
        if (e.key==='Enter' || e.key===' ' || e.code==='Space'){ e.preventDefault(); onToggle(); }
      });
      timerPower.dataset.bound = '1';
    }
    // reflect state
    if (window.state) timerPower.classList.toggle('active', !!window.state.timerPowerup);
  }

  // Icon counts using IconManager
  function applyIconCounts(){
    var hf = parseInt(($('in_hearts_fill')||{}).value||'1',10);
    var ho = parseInt(($('in_hearts_outline')||{}).value||'3',10);
    var sf = parseInt(($('in_shoes_fill')||{}).value||'3',10);
    var so = parseInt(($('in_shoes_outline')||{}).value||'5',10);
    var pf = parseInt(($('in_powers_fill')||{}).value||'4',10);
    var pt = parseInt(($('in_powers_total')||{}).value||'4',10);
    var ff = parseInt(($('in_fires_fill')||{}).value||'4',10);
    var fo = parseInt(($('in_fires_outline')||{}).value||'5',10);

    if (window.SneakerQuestUI && window.SneakerQuestUI.IconManager){
      window.SneakerQuestUI.IconManager.renderHearts(hf, ho);
      window.SneakerQuestUI.IconManager.renderSneakers(sf, so);
      // powers: total = pt, fill = pf
      (function(){
        var c = document.getElementById('ui-powers'); if (!c) return;
        c.innerHTML = '';
        var types = [ { b:'ph-timer', f:'ph-timer' }, { b:'ph-shield', f:'ph-shield' }, { b:'ph-magnet', f:'ph-magnet' }, { b:'ph-crosshair-simple', f:'ph-crosshair-simple' } ];
        for (var i=0;i<pt;i++){
          var t = types[i % types.length];
          c.insertAdjacentHTML('beforeend',
            '<div class="power '+(i<pf?'active':'')+'">'+
              '<i class="ph-bold '+t.b+'" aria-hidden="true"></i>'+
              '<i class="ph-fill '+t.f+'" aria-hidden="true"></i>'+
            '</div>'
          );
        }
      })();
      window.SneakerQuestUI.IconManager.renderFires(ff, fo);
    }
    // update outputs
    setText('o_hearts_fill', hf); setText('o_hearts_outline', ho);
    setText('o_shoes_fill', sf);  setText('o_shoes_outline', so);
    setText('o_powers_fill', pf); setText('o_powers_total', pt);
    setText('o_fires_fill', ff);  setText('o_fires_outline', fo);
    // rebind stopwatch after powers re-render
    rebindStopwatch();
  }

  // Gap controls
  function bindGap(id, target, cssProp, out){
    var input = $(id);
    function apply(){
      if (!input || !target) return;
      var val = parseInt(input.value,10)||0;
      target.style[cssProp] = px(val);
      if (out) setText(out, val);
    }
    if (input) input.addEventListener('input', apply);
    apply();
  }

  // Height control
  function bindHeight(id, target, out){
    var input = $(id);
    function apply(){ if(!input||!target) return; var v=parseInt(input.value,10)||0; target.style.height=px(v); if(out) setText(out,v); }
    if (input) input.addEventListener('input', apply); apply();
  }

  // Padding control
  function bindPadding(id, target, side, out){
    var input = $(id);
    function apply(){ if(!input||!target) return; var v=parseInt(input.value,10)||0; target.style['padding'+side]=px(v); if(out) setText(out,v); }
    if (input) input.addEventListener('input', apply); apply();
  }

  // Slot height helpers
  bindHeight('v_slotsneakers', document.querySelector('.hud .slot-heart'), 'o_slotsneakers');
  bindHeight('v_slotshoes', document.querySelector('.hud .slot-shoes'), 'o_slotshoes');
  bindHeight('v_slotdots', document.querySelector('.hud .slot-dots'), 'o_slotdots');
  bindHeight('v_slotflames', document.querySelector('.hud2 .slot-flames'), 'o_slotflames');
  bindHeight('v_slotpause', document.querySelector('.hud2 .slot-pause'), 'o_slotpause');
  bindHeight('v_slotbag', document.querySelector('.hud2 .slot-bag'), 'o_slotbag');

  // Layout spacing bindings
  bindGap('v_gap_top', marquee, 'marginTop', 'o_gap_top');
  bindGap('v_gap_div', divider, 'marginTop', 'o_gap_div');
  bindGap('v_gap_crt', crtWrap, 'marginTop', 'o_gap_crt');
  bindGap('v_gap_tabs', tabs, 'marginTop', 'o_gap_tabs');
  bindGap('v_gap_hud1', hud1, 'marginTop', 'o_gap_hud1');
  bindGap('v_gap_hud2', hud2, 'marginTop', 'o_gap_hud2');
  // Bottom height already exposed via height
  bindHeight('v_gap_bottom', bottom, 'o_gap_bottom');
  bindPadding('v_bot_a', controlScreen, 'Top', 'o_bot_a');
  bindPadding('v_bot_b', controlScreen, 'Bottom', 'o_bot_b');

  // Inner padding left/right
  bindPadding('v_global_pad_l', inner, 'Left', 'o_global_pad_l');
  bindPadding('v_global_pad_r', inner, 'Right', 'o_global_pad_r');

  // Scale
  (function(){
    var in_scale = $('v_scale');
    function apply(){
      if(!in_scale || !fixed) return;
      var s=parseFloat(in_scale.value||'1')||1;
      fixed.style.transform='translateX(-50%) scale(' + s.toFixed(2) + ')';
      setText('o_scale', s.toFixed(2));
    }
    if(in_scale) in_scale.addEventListener('input', apply);
    apply();
  })();

  // Center cell width
  (function(){
    var el=$('v_center_cell');
    function apply(){
      if(!el) return;
      var v=parseInt(el.value,10)||90;
      root.style.setProperty('--center-cell', v+'px');
      setText('o_center_cell', v);
    }
    if(el) el.addEventListener('input', apply);
    apply();
  })();

  // Marquee controls
  (function(){
    var tsize=$('v_mqtsize'), tx=$('v_mqtx'), ty=$('v_mqty');
    var ssz=$('v_mqssize'), sx=$('v_mqsx'), sy=$('v_mqsy');
    var br=$('v_chipbr'), pxpad=$('v_chippadx'), pypad=$('v_chippady');

    function applyTitle(){
      if (!mqTitle) return;
      var fs = parseInt((tsize&&tsize.value)||'27',10);
      var x  = parseInt((tx&&tx.value)||'0',10);
      var y  = parseInt((ty&&ty.value)||'0',10);
      mqTitle.style.fontSize = px(fs);
      mqTitle.style.transform = 'translate(' + x + 'px,' + y + 'px)';
      setText('o_mqtsize', fs); setText('o_mqtx', x); setText('o_mqty', y);
    }
    function applySub(){
      if (!mqSub) return;
      var fs = parseInt((ssz&&ssz.value)||'7',10);
      mqSub.style.fontSize = px(fs);
      var x = parseInt((sx&&sx.value)||'0',10);
      var y = parseInt((sy&&sy.value)||'0',10);
      mqSub.style.transform = 'translate(' + x + 'px,' + y + 'px)';
      setText('o_mqssize', fs); setText('o_mqsx', x); setText('o_mqsy', y);
      // chip box radius and padding
      var radius = parseInt((br&&br.value)||'4',10);
      var padX   = parseInt((pxpad&&pxpad.value)||'3',10);
      var padY   = parseInt((pypad&&pypad.value)||'4',10);
      document.querySelectorAll('.chip-box').forEach(function(n){
        n.style.borderRadius = px(radius);
        n.style.paddingLeft = px(padX);
        n.style.paddingRight = px(padX);
        n.style.paddingTop = px(padY);
        n.style.paddingBottom = px(padY);
      });
      setText('o_chipbr', radius); setText('o_chippadx', padX); setText('o_chippady', padY);
    }

    ['input','change'].forEach(function(evt){
      [tsize,tx,ty].forEach(function(el){ if(el) el.addEventListener(evt, applyTitle); });
      [ssz,sx,sy,br,pxpad,pypad].forEach(function(el){ if(el) el.addEventListener(evt, applySub); });
    });
    applyTitle(); applySub();
  })();

  // Icon Gaps
  (function(){
    function bind(id, targetSel, outId){
      var input=$(id), target=document.querySelector(targetSel);
      function apply(){ if(!input||!target) return; var n=parseInt(input.value,10)||0; target.style.gap=px(n); setText(outId, n); }
      if(input) input.addEventListener('input', apply); apply();
    }
    bind('v_icon_gap_sneakers', '#ui-sneakers', 'o_icon_gap_sneakers');
    bind('v_icon_gap_powers',   '#ui-powers',   'o_icon_gap_powers');
    bind('v_icon_gap_fires',    '#ui-fires',    'o_icon_gap_fires');
  })();

  // Counts bindings
  (function(){
    ['in_hearts_fill','in_hearts_outline','in_shoes_fill','in_shoes_outline','in_powers_fill','in_powers_total','in_fires_fill','in_fires_outline'].forEach(function(id){
      var el=$(id); if(el) el.addEventListener('input', applyIconCounts);
    });
    applyIconCounts();
  })();

  // Ensure LIFE tab a11y still intact from Step 1: no change needed

  // Reset to defaults
  (function(){
    var reset = document.getElementById('sReset');
    if (!reset) return;
    reset.addEventListener('click', function(){
      var defaults = {
        v_scale:1, v_center_cell:90,
        v_gap_top:0, v_gap_div:0, v_gap_crt:0, v_gap_tabs:-14, v_gap_hud1:-16, v_gap_hud2:-15, v_gap_bottom:150,
        v_bot_a:14, v_bot_b:14, v_global_pad_l:20, v_global_pad_r:20,
        v_mqtsize:27, v_mqtx:0, v_mqty:0, v_mqssize:7, v_mqsx:0, v_mqsy:0, v_chipbr:4, v_chippadx:3, v_chippady:4,
        v_icon_gap_sneakers:3, v_icon_gap_powers:7, v_icon_gap_fires:2,
        in_hearts_fill:1, in_hearts_outline:3, in_shoes_fill:3, in_shoes_outline:5, in_powers_fill:4, in_powers_total:4, in_fires_fill:4, in_fires_outline:5,
        v_slotsneakers:41, v_slotshoes:40, v_slotdots:40, v_slotflames:40, v_slotpause:40, v_slotbag:40
      };
      Object.keys(defaults).forEach(function(k){ var el=$(k); if(el){ el.value = defaults[k]; el.dispatchEvent(new Event('input')); } });
    });
  })();

  // Kick a first bind of stopwatch after DOM ready, in case powers already present
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', rebindStopwatch);
  } else {
    rebindStopwatch();
  }
})();
</script>

</body>
</html>
