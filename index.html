<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
  <title>SNEAKERQUEST — Interface</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/bold/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    /* Base variables (exactly as provided) */
    :root{
      --mq-title-size: 43;
      --mq-title-track: 0.38;
      --mq-title-x: 0px;
      --mq-title-y: 0px;
      --mq-sub-size: 13;
      --mq-sub-x: 1px;
      --mq-sub-y: 1px;
      --chip-br: 7;
      --chip-pad-x: 11;
      --chip-pad-y: 1;
      --chip-border: 1;
      --crt-fr: 0.4fr;
      --crt-ar: 0.970;
      --crt-r: 10;
      --crtwrap-pad: 13;
      --t1: 40%;
      --t2: 20%;
      --t3: 40%;
      --h1-a: 40%;
      --h1-b: 20%;
      --h1-c: 40%;
      --h2-a: 40%;
      --h2-b: 20%;
      --h2-c: 40%;
      --slot-heart-h: 46;
      --slot-shoes-h: 46;
      --slot-dots-h: 46;
      --slot-bag-h: 46;
      --slot-flames-h: 46;
      --slot-pause-h: 46;
      --slot-pad: 8;
      --bot-a: 80%;
      --bot-b: 20%;
      --tabs-pad-x-left: 12px;
      --tabs-pad-x-right: 32px;
      --hud1-pad-x-left: 0px;
      --hud1-pad-x-right: 21px;
      --hud2-pad-x-left: 0px;
      --hud2-pad-x-right: 21px;
      --tab-font-size: 26;
      --gap-tabs: 2px;
      --gap-hud1: -3px;
      --gap-hud2: -5px;
      --gap-bottom: -5px;
      --marquee-h: 90;
      --tabs-h: 80;
      --bottom-h: 240;

      /* Tab Bar Content */
      --tab1-text: "SNEAKERS";
      --tab2-text: "LIFE";
      --tab3-text: "POWER-UPS";

      /* Icon Amounts */
      --icons-hearts-fill: 4;
      --icons-hearts-outline: 1;
      --icons-shoes-fill: 2;
      --icons-shoes-outline: 1;
      --icons-powers-total: 4;
      --icons-fires-fill: 3;
      --icons-fires-outline: 2;
    }

    /* Interface styles (unchanged layout logic) */
    :root{--text:#d6c7a4;--led:#ff3a2f;--gap:10;--radius:16}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:#0a0a0a;color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;display:grid;place-items:center;min-height:100dvh;}
    .cabinet{border-radius:28px;padding:14px;background:radial-gradient(120% 120% at 50% 0,#000 0,#000 18%,#0000 18%),linear-gradient(#b99b66,#cbb17d 22%,#a98756 22%,#a98756 23%,#876a46 23%,#876a46 24%,#56432e 24%,#56432e 25%,#3d3123 25%,#3d3123 100%);box-shadow:inset 0 0 0 2px #1b1510,0 24px 40px #0008,0 6px 0 #0a0a0a}
    .inner{height:100%;border-radius:22px;padding:12px;display:grid;gap:calc(var(--gap)*1px);grid-template-rows:calc(var(--marquee-h)*1px) 12px var(--crt-fr) calc(var(--tabs-h)*1px) auto auto calc(var(--bottom-h)*1px);background:linear-gradient(#6c5640,#3c2f23 14%,#2e251d 14%,#2e251d);box-shadow:inset 0 0 0 2px #2a2119,inset 0 0 0 6px #1b1510;position:relative;isolation:isolate}
    .marquee{border-radius:18px;padding:12px 14px;background:linear-gradient(#2a2320,#1d1815);box-shadow:inset 0 0 0 2px #120e0c,inset 0 0 0 6px #2f2722,0 2px 0 #0a0807}
    .led{height:100%;border-radius:12px;background:radial-gradient(circle at 8px 10px,#fff1,transparent 28%),repeating-linear-gradient(180deg,#0006 0 3px,#0000 3px 10px),#120e0c;display:grid;padding:6px 10px;align-content:center}
    .led .line{font-family:ui-monospace,Menlo,Consolas,monospace;color:var(--led);text-shadow:0 0 2px var(--led),0 0 8px #ff3a2f73,0 0 14px #ff3a2f40;font-weight:800}
    @keyframes ledFx{0%{opacity:.96;text-shadow:0 0 2px var(--led),0 0 6px #ff3a2f61,0 0 12px #ff3a2f33}50%{opacity:1;text-shadow:0 0 2px var(--led),0 0 9px #ff3a2f80,0 0 16px #ff3a2f47}100%{opacity:.97;text-shadow:0 0 2px var(--led),0 0 6px #ff3a2f61,0 0 12px #ff3a2f33}}
    .led .line,.tab .led .line,.marquee .led .mq-sub .chip{animation:ledFx 3.6s ease-in-out infinite}
    @media (prefers-reduced-motion:reduce){.led .line,.tab .led .line,.marquee .led .mq-sub .chip{animation:none}}
    .mq-wrap{display:grid;justify-items:center;align-content:center;height:100%}
    .mq-title{font-size:calc(var(--mq-title-size)*1px);letter-spacing:calc(var(--mq-title-track)*1em);transform:translate(var(--mq-title-x),var(--mq-title-y));text-align:center;user-select:none}
    .mq-sub{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;font-size:calc(var(--mq-sub-size)*1px);letter-spacing:.12em;margin-top:6px;transform:translate(var(--mq-sub-x),var(--mq-sub-y))}
    .mq-sub .chip{white-space:nowrap}
    .mq-sub .chip-box{padding:calc(var(--chip-pad-y)*1px) calc(var(--chip-pad-x)*1px);border:calc(var(--chip-border)*1px) solid var(--led);border-radius:calc(var(--chip-br)*1px)}

    /* Pause/Play as text only (no chip shape) */
    .chip-btn{background:transparent;border:0;border-radius:0;padding:0;display:grid;place-items:center;position:relative;color:var(--led);font:inherit;letter-spacing:.12em;cursor:pointer;min-height:1em;line-height:1;min-width:6ch}
    .chip-btn:focus-visible{outline:none;text-shadow:0 0 6px var(--led),0 0 12px #ff3a2f66}
    .chip-btn .word{grid-area:1/1;display:block;text-align:center;opacity:0;transform:translateY(6%);transition:opacity .24s ease,transform .24s ease}
    #btn-pause[data-state=playing] .word-pause{opacity:1;transform:none}
    #btn-pause[data-state=paused] .word-play{opacity:1;transform:none}
    @media (prefers-reduced-motion:reduce){.chip-btn .word{transition:none}}

    .divider{height:12px;border-radius:10px;background:linear-gradient(#3b3026,#2a231e);box-shadow:inset 0 0 0 2px #1b1510}
    .crt-wrap{border-radius:20px;padding:calc(var(--crtwrap-pad)*1px);background:linear-gradient(#3c2f26,#241e18);box-shadow:inset 0 0 0 2px #1a140f,inset 0 0 0 8px #2a211a;display:grid;place-items:center}
    .crt{width:100%;aspect-ratio:var(--crt-ar);border-radius:calc(var(--crt-r)*1px);background:linear-gradient(180deg,#fff1,transparent 22%),linear-gradient(#0b2823,#0a241f);box-shadow:inset 0 0 0 2px #0e1412,inset 0 0 30px #0009;position:relative;overflow:hidden}
    .tabs{border-radius:14px;background:linear-gradient(#3a2f26,#2b231d);box-shadow:inset 0 0 0 2px #1a1410;display:grid;grid-template-columns:var(--t1) var(--t2) var(--t3);gap:calc(var(--gap)*1px);padding:10px var(--tabs-pad-x-right) 10px var(--tabs-pad-x-left);text-align:center;font-weight:800;letter-spacing:.08em;margin-top:var(--gap-tabs)}
    .tab{padding:0;border-right:1px solid #4d4032;display:grid;align-items:stretch}
    .tab:last-child{border-right:none}
    .tab .led{height:100%;border-radius:10px;padding:8px 10px;display:grid;place-items:center}
    .tab .led .line{font-size:calc(var(--tab-font-size)*1px);letter-spacing:.14em;color:var(--led);font-weight:800}
    .hud{display:grid;grid-template-columns:var(--h1-a) var(--h1-b) var(--h1-c);gap:calc(var(--gap)*1px);padding:0 var(--hud1-pad-x-right) 0 var(--hud1-pad-x-left);margin-top:var(--gap-hud1)}
    .hud2{display:grid;grid-template-columns:var(--h2-a) var(--h2-b) var(--h2-c);gap:calc(var(--gap)*1px);padding:0 var(--hud2-pad-x-right) 0 var(--hud2-pad-x-left);margin-top:var(--gap-hud2)}
    .slot{background:linear-gradient(#3a3227,#2c251e);border-radius:14px;padding:calc(var(--slot-pad)*1px);box-shadow:inset 0 0 0 2px #1a1511,0 2px 0 #0b0907;display:flex;align-items:center;justify-content:stretch;overflow:hidden}
    .slot-heart{height:calc(var(--slot-heart-h)*1px)}
    .slot-shoes{height:calc(var(--slot-shoes-h)*1px)}
    .slot-dots{height:calc(var(--slot-dots-h)*1px)}
    .slot-bag{height:calc(var(--slot-bag-h)*1px)}
    .slot-flames{height:calc(var(--slot-flames-h)*1px)}
    .slot-pause{height:calc(var(--slot-pause-h)*1px)}
    .slot>.led{height:100%;width:100%;border-radius:10px;padding:8px 10px;display:flex;align-items:center;justify-content:center}
    .slot>.led .line{display:flex;align-items:center;gap:10px;letter-spacing:.12em}
    .sneaker-outline,.heart-outline{color:var(--led)}
    .sneaker-fill,.slot-shoes .line{color:#e6e6e6}
    .btn-icon{display:inline-grid;place-items:center;padding:0;margin:0;border:0;background:transparent;color:inherit;cursor:pointer;line-height:1}
    .btn-icon .icon{font-size:1em;line-height:1}
    .btn-icon[data-state=playing] .icon-play{display:none}
    .btn-icon[data-state=paused] .icon-pause{display:none}
    .slot-pause .line,.slot-flames .line,.slot-dots .line,.slot-bag .line{font-size:20px}
    .slot-heart .line,.slot-shoes .line{font-size:20px}
    /* Hidden alternates for later activation */
    .is-off{display:none}
    .power .ph-bold{display:inline-block}
    .power .ph-fill{display:none}
    .power.power--armed .ph-bold{display:none}
    .power.power--armed .ph-fill{display:inline-block}
    .power .ph-crosshair-simple--filled{display:none}
    .power.power--armed .ph-crosshair-simple--filled{display:inline-block}
    .counter{display:flex;align-items:center;gap:10px;color:var(--led);text-shadow:0 0 6px var(--led),0 0 18px #ff3a2f73;font-weight:900;letter-spacing:.14em}
    .seven{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:20px;color:var(--text)}
    .bottom{display:grid;grid-template-columns:1fr;align-items:center;height:100%;margin-top:var(--gap-bottom)}
    .control-screen{position:relative;min-height:calc(var(--bottom-h)*1px);height:100%;border-radius:18px;padding:14px;display:grid;grid-template-columns:var(--bot-a) var(--bot-b);gap:14px;align-items:center;overflow:hidden;background:linear-gradient(#1a1210,#0c0908);box-shadow:inset 0 0 0 2px #1a1510,inset 0 16px 30px #0006,0 3px 0 #0a0807}
    @media (max-width:520px){.control-screen{grid-template-columns:1fr}}
    .matrix{position:absolute;inset:6px;border-radius:14px;opacity:.9;mix-blend-mode:screen;pointer-events:none;background:radial-gradient(circle at center,#140202 40%,#090101 42%,#0000 43%) 0 0/10px 10px repeat}
    @media (max-height:720px){:root{--marquee-h:70;--tabs-h:70;--bottom-h:210}}
    @media (max-height:640px){:root{--marquee-h:64;--tabs-h:64;--bottom-h:200}}


/* ==== ROBUSTNESS: prevent intrinsic overflow in grid children ==== */
.inner, .tabs, .hud, .hud2, .tab, .slot { min-width: 0; }
.tabs, .hud, .hud2 { overflow: visible; } /* content can breathe within panel borders */
.tab .label, .tab, .hud .label { white-space: nowrap; } /* LED labels should not wrap */




/* === Uniform scale wrapper === */
.device-scale {
  /* Base design size (from the original asset) */
  width: 996px;
  height: 2048px;
  position: relative;
  transform-origin: top left;
}

/* Compute a single scale factor s = min(vw/996, dvh/2048) */
@supports (height: 100dvh) {
  .device-scale {
    --s: min(100vw / 996, 100dvh / 2048);
    transform: scale(var(--s));
  }
}
@supports not (height: 100dvh) {
  .device-scale {
    --s: min(100vw / 996, 100vh / 2048);
    transform: scale(var(--s));
  }
}

/* Make .cabinet fill the fixed design box without its own sizing logic */
.device-scale > .cabinet {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  max-width: none;
  max-height: none;
  /* remove aspect/height driven sizing from .cabinet in this context */
  aspect-ratio: auto;
}

/* The centering container remains the owner of overflow */
.device-viewport {
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  overflow: hidden;
  background: #0a0a0a;
}



/* === FIX: valid scale math for .device-scale === */
.device-scale { transform-origin: top left; }

/* Primary path */
@supports (height: 100dvh) {
  .device-scale {
    /* Use calc() inside min() so the math parses */
    --s: min( calc(100vw / 996), calc(100dvh / 2048) );
    transform: scale(var(--s));
  }
}

/* Safari stable viewport fallback (address toolbar resizing) */
@supports (height: 100svh) {
  .device-scale {
    --s: min( calc(100vw / 996), calc(100svh / 2048) );
    transform: scale(var(--s));
  }
}

/* Legacy fallback if dvh/svh are not supported */
@supports not (height: 100dvh) and not (height: 100svh) {
  .device-scale {
    --s: min( calc(100vw / 996), calc(100vh / 2048) );
    transform: scale(var(--s));
  }
}

/* Ensure the fixed design box is present */
.device-scale { width: 996px; height: 2048px; position: relative; }
.device-scale > .cabinet { position: absolute; inset: 0; width: 100%; height: 100%; max-width: none; max-height: none; aspect-ratio: auto; }

</style>
</head>
<body>
  <div class="device-viewport">
    <div class="device-scale">
      <div class="cabinet">
    <div class="inner">
      <div class="marquee">
        <div class="led">
          <div class="mq-wrap">
            <div class="line mq-title" id="titleSQ">SNEAKERQUEST</div>
            <div class="line mq-sub">
              <span class="chip chip-stage chip-box">STAGE&nbsp;–&nbsp;01</span>
              <span class="chip chip-time chip-box">00:00:0</span>
              <span class="chip chip-score chip-box">SCORE&nbsp;000000</span>
            </div>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="crt-wrap">
        <div class="crt" aria-label="Screen placeholder"></div>
      </div>

      <div class="tabs">
        <div class="tab"><div class="led"><div class="line">SNEAKERS</div></div></div>
        <div class="tab"><div class="led"><div class="line">LIFE</div></div></div>
        <div class="tab"><div class="led"><div class="line">POWER-UPS</div></div></div>
      </div>

      <div class="hud">
        <div class="slot slot-heart"><div class="led"><div class="line" aria-label="Sneakers" id="ui-sneakers"></div></div></div>
        <div class="slot slot-shoes"><div class="led"><div class="line" aria-label="Hearts" id="ui-hearts"></div></div></div>
        <div class="slot slot-dots"><div class="led"><div class="line" aria-label="Powers" id="ui-powers"></div></div></div>
      </div>

      <div class="hud2">
        <div class="slot slot-flames"><div class="led"><div class="line" aria-label="Fire" id="ui-fires"></div></div></div>
        <div class="slot slot-pause"><div class="led"><div class="line" aria-label="Pause / Play">
          <button class="chip-btn" id="btn-pause" type="button" aria-pressed="false" aria-label="Pause" data-state="playing">
            <span class="word word-pause" aria-hidden="false">PAUSE</span>
            <span class="word word-play" aria-hidden="true">PLAY</span>
          </button>
        </div></div></div>
        <div class="slot slot-bag"><div class="led"><div class="line counter" aria-label="Box count">
          <i class="ph-fill ph-package" aria-hidden="true"></i>
          <span style="opacity:.8;letter-spacing:.12em">x</span>
          <span class="seven" id="counter">000</span>
        </div></div></div>
      </div>

      <div class="bottom">
        <div class="control-screen">
          <div class="matrix" aria-hidden="true"></div>
          <main class="control-ui" aria-label="Control surface">
            <section class="col-left"><div class="pad"></div></section>
            <section class="col-right"><div class="pad"></div></section>
          </main>
        </div>
      </div>
      </div>
    </div>
  </div>

  <script>
    // Interface-only render. Hidden alternates present for later use. No persistence.
    (function(){
      const $ = (id) => document.getElementById(id);
      const css = getComputedStyle(document.documentElement);
      const NUM = (name, d=0) => parseInt(css.getPropertyValue(name).trim()||d,10);

      const counts = {
        sneakersFill: NUM('--icons-hearts-fill', 4),      // sneakers = heartsFill in original mapping
        sneakersOutline: NUM('--icons-hearts-outline', 1),
        heartsFill: NUM('--icons-shoes-fill', 2),
        heartsOutline: NUM('--icons-shoes-outline', 1),
        powersTotal: NUM('--icons-powers-total', 4),
        firesFill: NUM('--icons-fires-fill', 3),
        firesOutline: NUM('--icons-fires-outline', 2)
      };

      function renderSneakers(fill, outline){
        const r = $('ui-sneakers'); if(!r) return; r.innerHTML='';
        // Visible state
        for(let i=0;i<outline;i++) r.insertAdjacentHTML('beforeend','<i class="ph-bold ph-sneaker sneaker-outline" aria-hidden="true"></i>');
        for(let i=0;i<fill;i++)   r.insertAdjacentHTML('beforeend','<i class="ph-fill ph-sneaker sneaker-fill" aria-hidden="true"></i>');
        // Hidden alternates for later toggling
        for(let i=0;i<fill;i++)   r.insertAdjacentHTML('beforeend','<i class="ph-bold ph-sneaker sneaker-outline is-off" aria-hidden="true"></i>');
        for(let i=0;i<outline;i++)r.insertAdjacentHTML('beforeend','<i class="ph-fill ph-sneaker sneaker-fill is-off" aria-hidden="true"></i>');
      }
      function renderHearts(fill, outline){
        const r = $('ui-hearts'); if(!r) return; r.innerHTML='';
        for(let i=0;i<fill;i++)   r.insertAdjacentHTML('beforeend','<i class="ph-fill ph-heart" aria-hidden="true"></i>');
        for(let i=0;i<outline;i++)r.insertAdjacentHTML('beforeend','<i class="ph-bold ph-heart heart-outline" aria-hidden="true"></i>');
        for(let i=0;i<fill;i++)   r.insertAdjacentHTML('beforeend','<i class="ph-bold ph-heart heart-outline is-off" aria-hidden="true"></i>');
        for(let i=0;i<outline;i++)r.insertAdjacentHTML('beforeend','<i class="ph-fill ph-heart is-off" aria-hidden="true"></i>');
      }
      function renderPowers(total){
        const r = $('ui-powers'); if(!r) return; r.innerHTML='';
        const defs = [
          { bold:'ph-timer', fill:'ph-timer' },
          { bold:'ph-shield', fill:'ph-shield' },
          { bold:'ph-magnet', fill:'ph-magnet' },
          { bold:'ph-crosshair-simple', fill:'svg' }
        ];
        for(let i=0;i<total;i++){
          const x = defs[i % defs.length];
          if(x.fill==='svg'){
            r.insertAdjacentHTML('beforeend','<span class="power power--idle">\
<i class="ph-bold '+x.bold+'" aria-hidden="true"></i>\
<svg class="ph-fill ph-crosshair-simple--filled is-off" viewBox="0 0 256 256" width="1em" height="1em" fill="currentColor" aria-hidden="true">\
<circle cx="128" cy="128" r="28"></circle>\
<path d="M128 32v32M128 192v32M32 128h32M192 128h32" stroke="currentColor" stroke-width="20" stroke-linecap="round" fill="none"/>\
</svg>\
</span>');
          } else {
            r.insertAdjacentHTML('beforeend','<span class="power power--idle">\
<i class="ph-bold '+x.bold+'" aria-hidden="true"></i>\
<i class="ph-fill '+x.fill+' is-off" aria-hidden="true"></i>\
</span>');
          }
        }
      }
      function renderFires(fill, outline){
        const r = $('ui-fires'); if(!r) return; r.innerHTML='';
        for(let i=0;i<fill;i++)   r.insertAdjacentHTML('beforeend','<i class="ph-fill ph-fire" aria-hidden="true"></i>');
        for(let i=0;i<outline;i++)r.insertAdjacentHTML('beforeend','<i class="ph-bold ph-fire" aria-hidden="true"></i>');
        for(let i=0;i<fill;i++)   r.insertAdjacentHTML('beforeend','<i class="ph-bold ph-fire is-off" aria-hidden="true"></i>');
        for(let i=0;i<outline;i++)r.insertAdjacentHTML('beforeend','<i class="ph-fill ph-fire is-off" aria-hidden="true"></i>');
      }
      function initPause(){
        const pb = document.getElementById('btn-pause'); if(!pb) return;
        const set = (st)=>{
          pb.dataset.state = st;
          const paused = st === 'paused';
          pb.setAttribute('aria-pressed', String(paused));
          pb.setAttribute('aria-label', paused ? 'Play' : 'Pause');
          const wPause = pb.querySelector('.word-pause');
          const wPlay = pb.querySelector('.word-play');
          if(wPause && wPlay){
            wPause.setAttribute('aria-hidden', String(paused));
            wPlay.setAttribute('aria-hidden', String(!paused));
          }
        };
        set('playing');
        pb.addEventListener('click',()=> set(pb.dataset.state==='playing'?'paused':'playing'));
        pb.addEventListener('keydown',(e)=>{
          if(e.key==='Enter' || e.key===' '){ e.preventDefault(); pb.click(); }
        });
      }

      // Render once using CSS-provided counts
      renderSneakers(counts.sneakersFill, counts.sneakersOutline);
      renderHearts(counts.heartsFill, counts.heartsOutline);
      renderPowers(counts.powersTotal);
      renderFires(counts.firesFill, counts.firesOutline);
      initPause();

      // --- Minimal test cases for the Pause/Play control ---
      function runPauseTests(){
        const pb = document.getElementById('btn-pause');
        const wPause = pb.querySelector('.word-pause');
        const wPlay = pb.querySelector('.word-play');
        const start = pb.dataset.state;
        try{
          console.assert(start==='playing', 'Initial state should be "playing"');
          console.assert(wPause.getAttribute('aria-hidden')==='false', 'PAUSE should be visible initially');
          console.assert(wPlay.getAttribute('aria-hidden')==='true', 'PLAY should be hidden initially');

          pb.click(); // -> paused
          console.assert(pb.dataset.state==='paused', 'State should change to "paused" after first click');
          console.assert(wPause.getAttribute('aria-hidden')==='true', 'PAUSE hidden when paused');
          console.assert(wPlay.getAttribute('aria-hidden')==='false', 'PLAY visible when paused');

          pb.click(); // -> playing
          console.assert(pb.dataset.state==='playing', 'State should return to "playing" after second click');
          console.assert(wPause.getAttribute('aria-hidden')==='false', 'PAUSE visible again');
          console.assert(wPlay.getAttribute('aria-hidden')==='true', 'PLAY hidden again');

          console.log('%cPause/Play tests passed','color:#0f0');
        } catch(err){
          console.error('Pause/Play tests failed', err);
        }
      }
      runPauseTests();
    })();
  </script>
  
<script>
(function(){
  function ready(fn){ if(document.readyState!=='loading') fn(); else document.addEventListener('DOMContentLoaded', fn); }

  ready(function(){
    const sel = { device: '.cabinet', bg: '.cabinet', ui: '.inner' };
    const q = s => document.querySelector(s);

    function rect(n){
      if(!n) return null;
      const r = n.getBoundingClientRect();
      return { x: Math.round(r.x), y: Math.round(r.y), w: Math.round(r.width), h: Math.round(r.height) };
    }
    function flags(n){
      if(!n) return null;
      const cs = getComputedStyle(n);
      return {
        transform: cs.transform,
        transformOrigin: cs.transformOrigin,
        overflow: cs.overflow,
        overflowX: cs.overflowX,
        overflowY: cs.overflowY,
        backgroundSize: cs.backgroundSize,
        backgroundPosition: cs.backgroundPosition
      };
    }

    const device = q(sel.device);
    const bg = q(sel.bg);
    const ui = q(sel.ui);

    const out = {
      devicePixelRatio: window.devicePixelRatio || 1,
      viewport: { w: window.innerWidth, h: window.innerHeight },
      boxes: {
        device: rect(device),
        background: rect(bg),
        ui: rect(ui)
      },
      styles: {
        device: flags(device),
        background: flags(bg),
        ui: flags(ui),
        body: (function(){ const cs = getComputedStyle(document.body); return { overflow: cs.overflow, overflowX: cs.overflowX, overflowY: cs.overflowY }; })()
      }
    };

    // Expose and log
    window.SCALING_MEASUREMENTS = out;
    try { console.log('SCALING_MEASUREMENTS', out); } catch(e){}

    // Lightweight overlay
    const box = document.createElement('div');
    box.id = 'scaling-debug';
    box.setAttribute('style', [
      'position:fixed','top:8px','left:8px','z-index:2147483647',
      'font:12px/1.35 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace',
      'color:#e6e6e6','background:rgba(0,0,0,.7)','padding:8px 10px','border-radius:6px',
      'pointer-events:none','white-space:pre','max-width:46ch'
    ].join(';'));
    function fmtBox(name,b){ return b ? `${name}: x=${b.x} y=${b.y} w=${b.w} h=${b.h}` : `${name}: null`; }
    const lines = [
      `DPR: ${out.devicePixelRatio}`,
      `Viewport: ${out.viewport.w}×${out.viewport.h}`,
      fmtBox('Device', out.boxes.device),
      fmtBox('Background', out.boxes.background),
      fmtBox('UI', out.boxes.ui),
      `Body overflow: ${out.styles.body.overflow}/${out.styles.body.overflowX}/${out.styles.body.overflowY}`,
      `Device transform: ${out.styles.device && out.styles.device.transform}`,
      `UI transform: ${out.styles.ui && out.styles.ui.transform}`
    ];
    box.textContent = lines.join('\n');
    document.body.appendChild(box);

    // --- Additional runtime tests (non-destructive) ---
    (function runOverlayTests(){
      try {
        console.assert(!!window.SCALING_MEASUREMENTS, 'SCALING_MEASUREMENTS should exist');
        const el = document.getElementById('scaling-debug');
        console.assert(!!el, '#scaling-debug should be present');
        console.assert(getComputedStyle(el).position === 'fixed', 'Overlay should be fixed');
        console.log('%cOverlay tests passed','color:#0f0');
      } catch (e) {
        console.error('Overlay tests failed', e);
      }
    })();
  });
})();
</script>
</body>
</html>
